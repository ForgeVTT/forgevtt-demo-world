{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297015478,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"10czADXZIkhqAVB5"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647190115626,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async (weaponName) => {\n                    console.log(weaponName)\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"16WnMyVB27WvaNYX"}
{"type":1,"user":"7dnqGCP7V37vnFvy","timestamp":1647908523078,"flavor":"","content":"Yeah, it worked better the way it was before this one. I'll revert it to that verson now","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"1Z9vCzC65J1FQ3yC"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648751559670,"flavor":"Greatsword - Attack Roll","content":"13","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":1,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":13,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"2RRFWiGBcrm2gzss"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165550708,"flavor":"Greatsword - Attack Roll","content":"32","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":20,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":32,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"2a5VL8nkSrknbMuL"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297079971,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"3B1yLjI9oje4xKPI"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165554243,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"3F7VdkXWWosGAO88"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647293688951,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"function() {\n    [native code]\n}"}}}},"_id":"3T4Lwbm2j18UpxZe"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296898046,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"3e0k9YMGuG7f943t"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297055426,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"3rrvOvu6zeua7EU2"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647294700013,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    console.log(`You did ${myDmg} damage`);\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"3tO1KXKy0hHhCDUs"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647294216492,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"42vGNqN8FKl2gWCt"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165386732,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"4Q7lTrzCg5IN5iTB"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297016607,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"4U86LxQSDPqZp0EV"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648750211352,"flavor":"Greatsword - Damage Roll (Slashing)","content":"5","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":1,\"active\":true},{\"result\":2,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":5,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"4UwBNFAdDPC02rM6"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648754001869,"flavor":"Greatsword - Damage Roll (Slashing)","content":"14","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":6,\"active\":true},{\"result\":6,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":14,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"55g7ouPVcVtOspog"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649161946864,"flavor":"","content":"You take a bite out of the delicious Bread","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"60t4UwxmYMNQ2A7z"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647191624393,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<h4 style=\"text-align:center\">Make an attack with your weapon!</h4><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"65ExlT4urP4dVMbd"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1647187981111,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"10","speaker":{"scene":"zSzzUy9FahZC2oa1","actor":"SIYsggkrLxyCsXE7","token":null,"alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":8,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":10,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"59J425593Wd6BKg3"}}},"_id":"6OPK2sOdfEcogXAm"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1647294755511,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"9","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":7,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":9,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"N5y4kE4Nrr0JMRdQ"}}},"_id":"6YkESigkcWCrJpl5"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647187999365,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===\"Battleaxe\"); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    let targetToken = game?.user?.targets?.first();\n                    // Optionally, tell the user to select target\n                    if (!targetToken) return () => { \n                        //Kevin Code:\n                        console.log(\"here\")\n                        new Dialog({\n                        content: \"You have to Target a token First\",\n                        buttons: {ok: {label: \"Ok\"}}\n                            \n                        }).render(true)\n                    }\n                    \n                    \n                    \n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"6fkcKzZhmyVJhcJz"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647293916180,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async function weaponCallback() {\n                    if (!weaponCallback.weapon) return;\n                    let myDmg = await weaponCallback.weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"70Fvymx3fnMwYPmU"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166309573,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                                popFlexibleDialog.execute(window.forge.demoWorld.roWeapon)\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"766JM48xdxQiBjKr"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297612980,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"7JZelP5S1W79QMcr"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165480837,"flavor":"Greatsword - Attack Roll","content":"24","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":12,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":24,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"7kAczkKPpe385kcy"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1647296096402,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"5","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":3,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":5,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"eIJpcJRnF6kYImbb"}}},"_id":"7ljRj99Se7Q35hJD"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296906229,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"7pnwcrn5KvEL35Cj"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647189429619,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"80CjmXwsdpKas0wc"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647293349925,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async function() {\n    console.log(`Testing binding for weapon ${this} ${this.weapon} ${weapon} ${JSON.stringify(this)} `)\n                    if (!this) return;\n                    let myDmg = await this.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"88LqfRsOaLhyMOYh"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647294480758,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let myDmg = await window.weapon.rollDamage();\n                    console.log(`You did ${myDmg} damage`);\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"8Cq7lKu1wRgNKj3J"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648753628365,"flavor":"Greatsword - Damage Roll (Slashing)","content":"11","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":6,\"active\":true},{\"result\":3,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":11,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"8VNs7SNiysbHgE04"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647191427379,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />\n            Make an attack with your weapon!<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"8vkQljI1DT4gzwlz"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297069427,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"9G4OEA8Dof3UhzyU"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648748932922,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"3","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":1,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":3,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"8tCTBfeP8TXRJMYf"}}},"_id":"9eabWY7lK5sZCUmL"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166312991,"flavor":"Greatsword - Attack Roll","content":"18","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":6,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":18,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"9iMU7mHE402E3O9J"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647294726099,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    console.log(`You did ${myDmg} damage`);\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"9kDsRnu12vzpjZYf"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1647295369889,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"7","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":5,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":7,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"N5y4kE4Nrr0JMRdQ"}}},"_id":"A7LqAhVCoQl7kQSE"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648749896881,"flavor":"<img src=\"`${window.forge?.demoWorld?.roWeapon.data?.img}`\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"AEIJfeZbhjMhoLDK"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165520101,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"APiTpqlY0clo4UU2"}
{"type":2,"user":"FRJk2q4bH9IdLZDf","timestamp":1647908222051,"flavor":"","content":"hahahaha","speaker":{"scene":"qE9GgC174smk0aPF","token":"8EdIT1rTFAjaQYc9","actor":"Voo7V2dvjq8OB72O","alias":"Kenku"},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"AV4rxl4PYi1YJhmX"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648754697614,"flavor":"Greatsword - Attack Roll","content":"21","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":9,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":21,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"BDqpPgV4rlP5CvVf"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647294226265,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async (weapon) => {\n                    if (!weapon) return;\n                    console.log(weapon)\n                    // let myDmg = await weapon.rollDamage();\n                    // let dmgTotal = myDmg.total;\n                    // await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    // let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    // if (!targetHp) return;\n                    // if (targetHp.value <= targetHp.min) {\n                    //     console.log(\"Target died!\");\n                    //     const macro = game.macros.getName(\"Dialog Wizard\");\n                    //     //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    // }\n                }"}}}},"_id":"CE9FTNtMxCKyYdkO"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648754698626,"flavor":"Greatsword - Damage Roll (Slashing)","content":"7","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":3,\"active\":true},{\"result\":2,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":7,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"CNGKreqjasDp4sDQ"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296896462,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"CwZhQxS5qRjeZaTC"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165527118,"flavor":"Greatsword - Damage Roll (Slashing)","content":"8","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":4,\"active\":true},{\"result\":2,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":8,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"DF2mSHcKRLKnTvgo"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647293027917,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":{}}}}},"_id":"DGFaVPcpouX1c3Dp"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165555694,"flavor":"Greatsword - Damage Roll (Slashing)","content":"5","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":1,\"active\":true},{\"result\":2,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":5,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"DGgXC99G5jIAFr0m"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165525395,"flavor":"Greatsword - Attack Roll","content":"17","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":5,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":17,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"Dr1iRGCVa9tNP4hP"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648751053321,"flavor":"Greatsword - Damage Roll (Slashing)","content":"11","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":6,\"active\":true},{\"result\":3,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":11,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"E7NziuiGD2CDDXZE"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296859057,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"EBLXZZyCr4wtU8qZ"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1647187823547,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"9","speaker":{"scene":"zSzzUy9FahZC2oa1","actor":"SIYsggkrLxyCsXE7","token":null,"alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":7,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":9,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"59J425593Wd6BKg3"}}},"_id":"EnVdXg5G9KEJp6PP"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296897478,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"EqmF17LYnTLrIdUV"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647294158907,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async (weapon) => {\n                    if (!weapon) return;\n                    console.log(weapon)\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"FMPqvNbx3ldSpfUS"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647191393860,"flavor":"","content":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />\n            Make an attack with your weapon!<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"FR6NdSKUtfrN9O4w"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165632369,"flavor":"Greatsword - Attack Roll","content":"32","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":20,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":32,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"FXnP3rk9svAVOhDV"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648748925139,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"FsFQP7vYM7gNkKuI"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165417656,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"FtFuYuLRrA507zyD"}
{"type":2,"user":"FRJk2q4bH9IdLZDf","timestamp":1647908539330,"flavor":"","content":"uhm","speaker":{"scene":"qE9GgC174smk0aPF","token":"8EdIT1rTFAjaQYc9","actor":"Voo7V2dvjq8OB72O","alias":"Kenku"},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"HCDRYFoIzdatc48p"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165430781,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"HWGIE08Cwq7BJEZp"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296917853,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"Hfcuq2AFVpR8C72N"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165469822,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"Hp3JbkEYjew458W6"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165521797,"flavor":"Greatsword - Damage Roll (Slashing)","content":"8","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":4,\"active\":true},{\"result\":2,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":8,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"HvoRdU7GSayDDfdw"}
{"type":1,"user":"7dnqGCP7V37vnFvy","timestamp":1647908170273,"flavor":"","content":":D","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"I2ICKv3F8Ul6pHGt"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297061023,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"I9ckmZnP5sHH9sWG"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296986158,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"IDjWrBMXfYbiLD4v"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648754179910,"flavor":"Greatsword - Attack Roll (Disadvantage)","content":"16","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":-1,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d20kl + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1,\"disadvantage\":true},\"evaluated\":true,\"number\":2,\"faces\":20,\"modifiers\":[\"kl\"],\"results\":[{\"result\":16,\"active\":false,\"discarded\":true},{\"result\":4,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":16,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"J5x3agJ6TyGozTvG"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296922041,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"JCLOgtzaBbV63UB3"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647188091896,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===\"Battleaxe\"); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    let targetToken = game?.user?.targets?.first();\n                    // Optionally, tell the user to select target\n                    if (!targetToken) return new Dialog({\n                        content: \"You have to Target a token First\",\n                        buttons: {ok: {label: \"Ok\"}}\n                            \n                        }).render(true)\n                    \n                    \n                    \n                    \n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"JJBfuFpIAvEBdct2"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647290124373,"flavor":"","content":"/play-audio","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"JSGwKChF2A7NOuKx"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647294365601,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async function weaponCallback() {\n                    let myDmg = await window.weapon.rollDamage();\n                    console.log(`You did ${myDmg} damage`);\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"JdH4JrHVPia0eVD5"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648750333658,"flavor":"Greatsword - Damage Roll (Slashing)","content":"8","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":3,\"active\":true},{\"result\":3,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":8,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"JeIqVKdNRr8UrrUR"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647189629176,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"JparZIt3p3eaIw2r"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165632395,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"JrY1crvzGs9ZPTgE"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647298515694,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"JzGH2t6oc8bFDZyx"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648753620768,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n                    const popFlexibleDialog = game.macros.find(x=>x.name === `PopFlexibleDialog`);\n                    if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                    if (!weapon) return;\n                    let myAtk = await weapon.rollAttack();\n                    if (!myAtk) return;\n                    let isFumble = myAtk.terms[0].number === 1;\n                    if (isFumble) {\n                        let myDmg = await weapon.rollDamage();\n                        let dmgTotal = myDmg.total;\n                        await targetToken.actor.applyDamage(dmgTotal);\n\n                        let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                        if (!targetHp) return;\n                        if (targetHp.value <= targetHp.min) {\n                            console.log(\"Target died!\");\n                            const macro = game.macros.getName(\"Dialog Wizard\");\n                            macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                        } else {\n                            // TODO prompt the player to attack again\n                            popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n\n                        }\n                    } else {\n                        // TODO prompt \"you missed!\"\n                        // TODO prompt the player to attack again\n                        popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                    }\n                }"}}}},"_id":"KL0EbSrPUJAszlzE"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648753367110,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n                    const popFlexibleDialog = game.macros.find(x=>x.name === `PopFlexibleDialog`);\n                    if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                    if (!weapon) return;\n                    let myAtk = await weapon.rollAttack();\n                    if (!myAtk) return;\n                    let isFumble = myAtk.terms[0].number === 1;\n                    if (!isFumble) {\n                        let myDmg = await weapon.rollDamage();\n                        let dmgTotal = myDmg.total;\n                        await targetToken.actor.applyDamage(dmgTotal);\n\n                        let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                        if (!targetHp) return;\n                        if (targetHp.value <= targetHp.min) {\n                            console.log(\"Target died!\");\n                            const macro = game.macros.getName(\"Dialog Wizard\");\n                            macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                        } else {\n                            // TODO prompt the player to attack again\n                            popFlexibleDialog.execute(JSON.stringify({content:\"Attack again!\",buttons:{ok: {label: \"Ok\"}}}))\n\n                        }\n                    } else {\n                        // TODO prompt \"you missed!\"\n                        // TODO prompt the player to attack again\n                        popFlexibleDialog.execute(JSON.stringify({content:\"You missed! Attack again!\",buttons:{ok: {label: \"Ok\"}}}))\n                    }\n                }"}}}},"_id":"KQMatXb7KqeU19Vq"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296918624,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"KitKRgnjY6DVvgYu"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296858355,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"L8jF8G6lFnLdHfle"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647191360342,"flavor":"","content":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"75px\" height=\"75px\" />Make an attack with your weapon!<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"La2GSu77tVSBhivU"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648749328185,"flavor":"<img src=\"`${window.forge?.demoWorld?.roWeapon.data?.img}`\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"M5p60vUkbCmsV0Ha"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647187977770,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===\"Battleaxe\"); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    let targetToken = game?.user?.targets?.first();\n                    // Optionally, tell the user to select target\n                    if (!targetToken) return () => { \n                        //Kevin Code:\n                        new Dialog({\n                        content: \"You have to Target a token First\",\n                        buttons: {ok: {label: \"Ok\"}}\n                            \n                        }).render(true)\n                    }\n                    \n                    \n                    \n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"MLhd1f76x4V47Mcg"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647298505456,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"MboZ6qKk0aK9v5fN"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648753625715,"flavor":"Greatsword - Attack Roll","content":"21","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":9,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":21,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"NI9VkDwAhY4E7t6H"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647293614753,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"function() {\n    [native code]\n}"}}}},"_id":"Ndt2ALv2wQCPadaI"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647190051579,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async (weaponName) => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"NwU210eyhHTGqUmH"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165517719,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"OCtOB1CugB41MZTf"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165565528,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"OEIppnZO7Nho5FgZ"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649161958821,"flavor":"","content":"/play-audio","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"OG99u3FdPqXyWaGs"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297539513,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"OcCehgOgtcYAAB5X"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297016144,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"OwJuxcFO8ai6Xi9R"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648749469716,"flavor":"<img src=\"`${weaponImg}`\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"P8XT8fNr14IOR39d"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647294135831,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"PRjvMjWlkneh3qrm"}
{"type":2,"user":"FRJk2q4bH9IdLZDf","timestamp":1647908218843,"flavor":"","content":"uhm","speaker":{"scene":"qE9GgC174smk0aPF","token":"8EdIT1rTFAjaQYc9","actor":"Voo7V2dvjq8OB72O","alias":"Kenku"},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"Pg7XjcDF1BIskIfD"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165432887,"flavor":"Greatsword - Damage Roll (Slashing)","content":"7","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":4,\"active\":true},{\"result\":1,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":7,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"Pqg524W8n1Tl67Bw"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165411976,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"PyT3Rv5ouMuznHJU"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1647188002622,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"4","speaker":{"scene":"zSzzUy9FahZC2oa1","actor":"SIYsggkrLxyCsXE7","token":null,"alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":2,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":4,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"59J425593Wd6BKg3"}}},"_id":"Q1q2LcyHdpJHYQ1B"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648750327883,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"Q5rZ8ufOisos48t3"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647191676838,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"Q9LKQrT0axfJbhkF"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165547007,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"QZz7KCDKuE0klZQd"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648749983852,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"Qdy9H1zuHqagBorr"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296859862,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"RJqLvzzSWmMIUgRS"}
{"type":1,"user":"7dnqGCP7V37vnFvy","timestamp":1647908264222,"flavor":"","content":"Oh wait no I think I broke it again","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"RKUb5r21217hkgXI"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648749101426,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"ReoeAIitVKxZN0U4"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165430765,"flavor":"Greatsword - Attack Roll","content":"20","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":8,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":20,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"SJ2IY4OuFv7IyKAT"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647189784923,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"SK1jF05YDf7SWr9E"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296859988,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"SefO5yQIySrYiO4I"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1647296990049,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"9","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":7,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":9,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"tMhYdOMNTMTGhJ7F"}}},"_id":"TLDzgFT59Zx8DfnI"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648754692612,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n                    const popFlexibleDialog = game.macros.find(x=>x.name === `PopFlexibleDialog`);\n                    if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                    if (!weapon) return;\n                    let myAtk = await weapon.rollAttack();\n                    if (!myAtk) return;\n                    let isFumble = myAtk.terms[0].number === 1;\n                    if (isFumble) {\n                        let myDmg = await weapon.rollDamage();\n                        let dmgTotal = myDmg.total;\n                        await targetToken.actor.applyDamage(dmgTotal);\n\n                        let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                        if (!targetHp) return;\n                        if (targetHp.value <= targetHp.min) {\n                            console.log(\"Target died!\");\n                            const macro = game.macros.getName(\"Dialog Wizard\");\n                            macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                        } else {\n                            // TODO prompt the player to attack again\n                            popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n\n                        }\n                    } else {\n                        // TODO prompt \"you missed!\"\n                        // TODO prompt the player to attack again\n                        popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                    }\n                }"}}}},"_id":"TkLpW8adGiInDRf5"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165633819,"flavor":"Greatsword - Damage Roll (Slashing)","content":"5","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":1,\"active\":true},{\"result\":2,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":5,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"TmmJHiHU2d4eYR0s"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297015207,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"U1b2xW49aQ5ZBe10"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647191489121,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<h4 style=\"text-align:center\">Make an attack with your weapon!</h4><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"US972vdAzmTSEnLT"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648750218917,"flavor":"Greatsword - Damage Roll (Slashing)","content":"8","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":4,\"active\":true},{\"result\":2,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":8,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"V5rm9NDSEAFqUY0E"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647293060719,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":{}}}}},"_id":"VBHnF0rRqx3KMCzK"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296859644,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"VIUI0hFmbFkTxyHh"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648749513430,"flavor":"<img src=\"`${window.forge?.demoWorld?.roWeapon.data?.img}`\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"VYRtfWFBZpjI9jlv"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647190477942,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async (weaponName, test) => {\n                    console.log(test)\n                    console.log(weaponName)\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"WpZEIHXdVvDjom0m"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649162079740,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n                    const popFlexibleDialog = game.macros.find(x=>x.name === `PopFlexibleDialog`);\n                    if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                    if (!weapon) return;\n                    let myAtk = await weapon.rollAttack();\n                    if (!myAtk) return;\n                    let isFumble = myAtk.terms[0].number === 1;\n                    if (isFumble) {\n                        let myDmg = await weapon.rollDamage();\n                        let dmgTotal = myDmg.total;\n                        await targetToken.actor.applyDamage(dmgTotal);\n\n                        let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                        if (!targetHp) return;\n                        if (targetHp.value <= targetHp.min) {\n                            console.log(\"Target died!\");\n                            const macro = game.macros.getName(\"Dialog Wizard\");\n                            macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                        } else {\n                            // TODO prompt the player to attack again\n                            popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n\n                        }\n                    } else {\n                        // TODO prompt \"you missed!\"\n                        // TODO prompt the player to attack again\n                        popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                    }\n                }"}}}},"_id":"WwcVhxArSulvYjJw"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165554234,"flavor":"Greatsword - Attack Roll","content":"22","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":10,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":22,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"X0p8eNiSjZUdfhqM"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165568611,"flavor":"Greatsword - Attack Roll","content":"30","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":18,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":30,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"YNZtqUxFUq4qd29K"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648750206117,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"YlI47o041MnCMT7o"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165520091,"flavor":"Greatsword - Attack Roll","content":"31","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":19,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":31,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"ZH6tqXKItXCJnrW8"}
{"type":2,"user":"FRJk2q4bH9IdLZDf","timestamp":1647908552041,"flavor":"","content":"next scene still executes it atm :laugh:","speaker":{"scene":"qE9GgC174smk0aPF","token":"8EdIT1rTFAjaQYc9","actor":"Voo7V2dvjq8OB72O","alias":"Kenku"},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"ZVhptJe7g2iaMJuo"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296848845,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"ZWDgR5DCgVqtEgWO"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647294144159,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"ZWT0YFzEExZaZqfk"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1647295079610,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"9","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":7,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":9,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"N5y4kE4Nrr0JMRdQ"}}},"_id":"aSOI7Y20fBLZ8t4f"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648751146622,"flavor":"Greatsword - Attack Roll","content":"26","speaker":{"scene":"12ajMsqaR3OBQxZb","token":"YlRS1nhrczrWnjB8","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":14,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":26,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"adCpEoMoCygb0IJI"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165486260,"flavor":"Greatsword - Attack Roll","content":"19","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":7,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":19,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"aePi2ec71KJN2OAh"}
{"type":2,"user":"FRJk2q4bH9IdLZDf","timestamp":1647908390282,"flavor":"","content":"did it not work the way we did it before?","speaker":{"scene":"qE9GgC174smk0aPF","token":"8EdIT1rTFAjaQYc9","actor":"Voo7V2dvjq8OB72O","alias":"Kenku"},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"amOC7CXPZVzmQgIZ"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647294192186,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"at4wKnbzdpSS5HqG"}
{"type":1,"user":"FRJk2q4bH9IdLZDf","timestamp":1647907799435,"flavor":"","content":"*cry*","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"bBFh8TiWcggwiXr4"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648753389653,"flavor":"Greatsword - Attack Roll","content":"17","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":5,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":17,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"bMlsxy2hhHX9sGC9"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166313017,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                                popFlexibleDialog.execute(window.forge.demoWorld.roWeapon)\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"bRgytoPUC6qAwfy0"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647191018079,"flavor":"","content":"You make an attack with your weapon!<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"bTqdIsGr9MGGmsdG"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296909628,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"bgbCZoYC68y8GjhW"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648749315550,"flavor":"<img src=\"`${window.forge?.demoWorld?.roWeapon.data?.img}`\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"bpWHOaYAAoDvgA1a"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296945324,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"c98VZ8UyloQL797B"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647190526983,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async (a,b,c,d,e,f) => {\n                    console.log(a,b,c,d,e,f)\n                    \n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"c9htRBxc6RbmsjmS"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296917152,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"cBduvhmaN3lwLvKL"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296933132,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"dAU2TJPsCyHWSRap"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647294701111,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => console.log(this)"}}}},"_id":"dByF0UVgQOPZCzlB"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647294760688,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async (weapon) => console.log(weapon)"}}}},"_id":"dMM6cUkNWq7YzIOo"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647294257343,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async function weaponCallback() {\n                    let myDmg = await window.weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"dMfh6EqSHoau83vY"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165547007,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"dXE9Lhhf3BqONnqY"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647296582698,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"dsxc8fZoxw4meHJi"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648751482879,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myAtk = await weapon.rollAttack();\n                    // if (myAtk >= targetToken.actor.data.data.attributes.ac.value)\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    } else {\n                        // TODO prompt the player to attack again\n                    }\n                }"}}}},"_id":"duGfde2dVmNUd3qC"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165629759,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"dzXfb9dZ1KJcnJF5"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297014243,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"el7F0rfRH2krA3jM"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165437112,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"elR3kxjrPGrjVLYb"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647294263968,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async (weapon,a,b,c,d,f) => {\n                    if (!weapon) return;\n                    console.log(weapon,a,b,c,d,f)\n                    // let myDmg = await weapon.rollDamage();\n                    // let dmgTotal = myDmg.total;\n                    // await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    // let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    // if (!targetHp) return;\n                    // if (targetHp.value <= targetHp.min) {\n                    //     console.log(\"Target died!\");\n                    //     const macro = game.macros.getName(\"Dialog Wizard\");\n                    //     //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    // }\n                }"}}}},"_id":"epwzMwTCTCLkceg7"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165570219,"flavor":"Greatsword - Damage Roll (Slashing)","content":"13","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":6,\"active\":true},{\"result\":5,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":13,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"f2s7pzPabkuJeGP8"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296919989,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"f72ieXEJfZ7GqBju"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648749229916,"flavor":"<img src=\"`${window.forge.demoWorld.roWeapon.data.img}`\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"fL0hHgkiKtMGjbtM"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647190450971,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async (weaponName, test) => {\n                    console.log(pork)\n                    console.log(weaponName)\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"fhdfh6pWMuo0JZiW"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648753999570,"flavor":"Greatsword - Attack Roll","content":"14","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":2,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":14,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"foK6Mibd6w3Utc1J"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296895928,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"ga2bxMi5oGNUqicC"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648754660241,"flavor":"Greatsword - Damage Roll (Slashing)","content":"12","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":4,\"active\":true},{\"result\":6,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":12,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"hc3PQxeJS07aBEe5"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647191652869,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h4 style=\"text-align:center\">Make an attack with your weapon!</h4><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"hhuapuBpU67Jp32I"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647290124373,"flavor":"","content":"/play-audio","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"hsA9pCVeBQ7nBxGb"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648750216350,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"iE0dIMhdVYAjOag0"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647190598108,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async (a,b,c,d,e,f) => {\n                    console.log(args[0])\n                    \n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"iEIgTtJyyi7zasDM"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648754657490,"flavor":"Greatsword - Attack Roll","content":"14","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":2,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":14,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"iG8p9MvJTq9mnbUL"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648751045684,"flavor":"Greatsword - Attack Roll","content":"13","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":1,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":13,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"iMzj2RI09aTZUsfb"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296092876,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    console.log(`You did ${myDmg} damage`);\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"j7Ae6zfL4Sm04I7E"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165629759,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"jCj4F5bSZhG6U9Xa"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1647294515904,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"6","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":4,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":6,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"N5y4kE4Nrr0JMRdQ"}}},"_id":"jCmsadVz5cSiFK5D"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1647188095296,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"8","speaker":{"scene":"zSzzUy9FahZC2oa1","actor":"SIYsggkrLxyCsXE7","token":null,"alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":6,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":8,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"59J425593Wd6BKg3"}}},"_id":"jW4JxiVWpDnb4IXT"}
{"type":1,"user":"7dnqGCP7V37vnFvy","timestamp":1647908198784,"flavor":"","content":"*pat pat*","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"jbdNYfqCmNItjcKl"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647294667369,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack"}}}},"_id":"k3HqtQ8l50qJAUTi"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1647294504392,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"10","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":8,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":10,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"N5y4kE4Nrr0JMRdQ"}}},"_id":"k9Oo75wFeBZbvy2X"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648754172576,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n                    const popFlexibleDialog = game.macros.find(x=>x.name === `PopFlexibleDialog`);\n                    if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                    if (!weapon) return;\n                    let myAtk = await weapon.rollAttack();\n                    if (!myAtk) return;\n                    let isFumble = myAtk.terms[0].number === 1;\n                    if (isFumble) {\n                        let myDmg = await weapon.rollDamage();\n                        let dmgTotal = myDmg.total;\n                        await targetToken.actor.applyDamage(dmgTotal);\n\n                        let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                        if (!targetHp) return;\n                        if (targetHp.value <= targetHp.min) {\n                            console.log(\"Target died!\");\n                            const macro = game.macros.getName(\"Dialog Wizard\");\n                            macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                        } else {\n                            // TODO prompt the player to attack again\n                            popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n\n                        }\n                    } else {\n                        // TODO prompt \"you missed!\"\n                        // TODO prompt the player to attack again\n                        popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                    }\n                }"}}}},"_id":"kH7muBS99ML5C6RD"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165417656,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"kKUPv6lwdTFY9o2I"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165517719,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"l0siwVS0NISXDS8a"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165550724,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"l1H0FBBQUWJObaSN"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165525403,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"l6vojD5skUPlOrhw"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647292703729,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"lm6SGQiO8b0ErvAh"}
{"type":1,"user":"7dnqGCP7V37vnFvy","timestamp":1647908273397,"flavor":"","content":"Tried to do it without globals","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"loEi4gcdemOH2NGv"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648749131438,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"lx5ufnbwXZoAsRvu"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297381057,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"mBPARsttP78k9I7R"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297026599,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"mOwEITkg6T6uRBhg"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648751486766,"flavor":"Greatsword - Attack Roll","content":"26","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":14,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":26,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"mj2aMtaZHaM19Y03"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647191288978,"flavor":"","content":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" />Make an attack with your weapon!<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"msXeuA1YLBYgNxXH"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1647293066931,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"7","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":5,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":7,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"N5y4kE4Nrr0JMRdQ"}}},"_id":"oIpgZiEc692XBnxP"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296898856,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"oK3DDQtWD1BZ2yn9"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647189862072,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"oS8fGNxHsYNQO5nC"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296860194,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"oghNQNLb5DqaPcFL"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647189527983,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"pBW95qMqQ0FLfUo4"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296912706,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"pC1N9ev9km0Wd0BD"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648754043757,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n                    const popFlexibleDialog = game.macros.find(x=>x.name === `PopFlexibleDialog`);\n                    if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                    if (!weapon) return;\n                    let myAtk = await weapon.rollAttack();\n                    if (!myAtk) return;\n                    let isFumble = myAtk.terms[0].number === 1;\n                    if (isFumble) {\n                        let myDmg = await weapon.rollDamage();\n                        let dmgTotal = myDmg.total;\n                        await targetToken.actor.applyDamage(dmgTotal);\n\n                        let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                        if (!targetHp) return;\n                        if (targetHp.value <= targetHp.min) {\n                            console.log(\"Target died!\");\n                            const macro = game.macros.getName(\"Dialog Wizard\");\n                            macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                        } else {\n                            // TODO prompt the player to attack again\n                            popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n\n                        }\n                    } else {\n                        // TODO prompt \"you missed!\"\n                        // TODO prompt the player to attack again\n                        popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                    }\n                }"}}}},"_id":"pQOtZpcSE9GsYxux"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165488245,"flavor":"Greatsword - Attack Roll","content":"32","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":20,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":32,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"peRKSgTFcLsjrzOZ"}
{"type":0,"user":"bWT4RleWjkaYiYKA","timestamp":1647290936960,"flavor":"","content":"You take a bite out of the delicious Bread","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"pfbXlUrZEtdvmPRk"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165629759,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"pjmQ883YgCEcdJaz"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296896892,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"poddY99E4ygl5Q96"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165568621,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"r0JUY8BhkQE35LU6"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647296895175,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"r5PquLqVcaekuuEx"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647293926516,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async function weaponCallback() {\n                    if (!weaponCallback.weapon) return;\n                    let myDmg = await weaponCallback.weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"rp22jDdmrQ8OmYtm"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648751037661,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myAtk = await weapon.rollAttack();\n                    // if (myAtk >= targetToken.actor.data.data.attributes.ac.value)\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n\n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    } else {\n                        // TODO prompt the player to attack again\n                    }\n                }"}}}},"_id":"s0OfLiKB2MDK7zYP"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647191332918,"flavor":"","content":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp width=\" height=\"75px\" />Make an attack with your weapon!<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"sAIemU99BFHCbEvr"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647191440035,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"Make an attack with your weapon!<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"sMKpHg3Anmmm1OTZ"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165629759,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"t1rGHXR5c3rNXvoU"}
{"type":1,"user":"7dnqGCP7V37vnFvy","timestamp":1647908180502,"flavor":"","content":"The repeater is working now I think","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"tNJD5q8Ct4eqEBYG"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647191473388,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"tbCMUjLnxSF6hgXy"}
{"type":1,"user":"7dnqGCP7V37vnFvy","timestamp":1647908589506,"flavor":"","content":"Yeah, I tried a different guard that prevents it from triggering on a close. Close seems to always fire","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"tqxZOEbEAtiIWP6j"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165438648,"flavor":"Greatsword - Damage Roll (Slashing)","content":"7","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":4,\"active\":true},{\"result\":1,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":7,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"upcIcvHjTW88skcp"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647293769518,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"function() {\n    [native code]\n}"}}}},"_id":"vfUlcY3zHbiojHYO"}
{"type":2,"user":"FRJk2q4bH9IdLZDf","timestamp":1647908289104,"flavor":"","content":"I have the dialog oin the bandit fight scene now","speaker":{"scene":"qE9GgC174smk0aPF","token":"8EdIT1rTFAjaQYc9","actor":"Voo7V2dvjq8OB72O","alias":"Kenku"},"whisper":[],"blind":false,"emote":false,"flags":{},"_id":"vsRV68kGVkRvGX9M"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165629759,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                ChatMessage.create(window.forge.demoWorld.attackTargetTokenAutomateMsg);\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"w0Z9ZVlCV5E9qLHM"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165552426,"flavor":"Greatsword - Damage Roll (Slashing)","content":"8","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":2,\"active\":true},{\"result\":4,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":8,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"w5TzkIv4ofFrRcNd"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648753846043,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n                    const popFlexibleDialog = game.macros.find(x=>x.name === `PopFlexibleDialog`);\n                    if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                    if (!weapon) return;\n                    let myAtk = await weapon.rollAttack();\n                    if (!myAtk) return;\n                    let isFumble = myAtk.terms[0].number === 1;\n                    if (isFumble) {\n                        let myDmg = await weapon.rollDamage();\n                        let dmgTotal = myDmg.total;\n                        await targetToken.actor.applyDamage(dmgTotal);\n\n                        let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                        if (!targetHp) return;\n                        if (targetHp.value <= targetHp.min) {\n                            console.log(\"Target died!\");\n                            const macro = game.macros.getName(\"Dialog Wizard\");\n                            macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                        } else {\n                            // TODO prompt the player to attack again\n                            popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n\n                        }\n                    } else {\n                        // TODO prompt \"you missed!\"\n                        // TODO prompt the player to attack again\n                        popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                    }\n                }"}}}},"_id":"w7d2GHzjUG5byBeA"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165437104,"flavor":"Greatsword - Attack Roll","content":"19","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":7,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":19,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"wsQdaBXtLIEKoSzQ"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1647293032084,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"5","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":3,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":5,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"N5y4kE4Nrr0JMRdQ"}}},"_id":"x3nMXV4icw94jNZQ"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647295076160,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    console.log(`You did ${myDmg} damage`);\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"xbBi2NTt26EYS6a5"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647187818042,"flavor":"pop","content":"Bam<br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===\"Battleaxe\"); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    let targetToken = game?.user?.targets?.first();\n                    // Optionally, tell the user to select target\n                    if (!targetToken) return /*new Dialog({\n                    //Kevin Code:\n                        content: \"You have to Target a token First\",\n                        buttons: {ok: {label: \"Ok\"}}}).render(true)\n                    }*/\n                    \n                    \n                    \n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"xgdm0PhpspAD2Lka"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166314662,"flavor":"Greatsword - Damage Roll (Slashing)","content":"10","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":3,\"active\":true},{\"result\":5,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":10,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"y7LrERMqGAby3bKt"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1648753396839,"flavor":"Greatsword - Attack Roll","content":"27","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":15,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":27,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"1IC8dYxWBDqlD5J0"}}},"_id":"yozFBpHhFpYol7Q4"}
{"type":5,"user":"7dnqGCP7V37vnFvy","timestamp":1647294518530,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"3","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":1,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":3,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"N5y4kE4Nrr0JMRdQ"}}},"_id":"ypBx5rAjcAzOv1HC"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649165411962,"flavor":"Greatsword - Attack Roll","content":"19","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":7,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":19,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"z16ZyKnnwYA8juK4"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1647291289735,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    let ro = game.actors.find(x=>x.name===\"Ro\");\n                    let axe = ro.data.items.find(x=>x.name===weaponName); // Reference arg for weapon name\n                    let myDmg = await axe.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    \n                    console.log(`Did ${dmgTotal} damage!`);\n                    \n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        //macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"zLpVodX8cCQmAM0G"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1647297430582,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n\n                    if (!weapon) return;\n                    let myDmg = await weapon.rollDamage();\n                    let dmgTotal = myDmg.total;\n                    await targetToken.actor.applyDamage(dmgTotal);\n                    \n                    let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                    if (!targetHp) return;\n                    if (targetHp.value <= targetHp.min) {\n                        console.log(\"Target died!\");\n                        const macro = game.macros.getName(\"Dialog Wizard\");\n                        macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                    }\n                }"}}}},"_id":"zPTJ3ILna2aRJ0nN"}
{"type":0,"user":"7dnqGCP7V37vnFvy","timestamp":1648754654226,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n                    const weapon = window.forge?.demoWorld?.roWeapon;\n                    const targetToken = window.forge?.demoWorld?.roTarget;\n                    const popFlexibleDialog = game.macros.find(x=>x.name === `PopFlexibleDialog`);\n                    if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                    if (!weapon) return;\n                    let myAtk = await weapon.rollAttack();\n                    if (!myAtk) return;\n                    let isFumble = myAtk.terms[0].number === 1;\n                    if (isFumble) {\n                        let myDmg = await weapon.rollDamage();\n                        let dmgTotal = myDmg.total;\n                        await targetToken.actor.applyDamage(dmgTotal);\n\n                        let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                        if (!targetHp) return;\n                        if (targetHp.value <= targetHp.min) {\n                            console.log(\"Target died!\");\n                            const macro = game.macros.getName(\"Dialog Wizard\");\n                            macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                        } else {\n                            // TODO prompt the player to attack again\n                            popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n\n                        }\n                    } else {\n                        // TODO prompt \"you missed!\"\n                        // TODO prompt the player to attack again\n                        popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                    }\n                }"}}}},"_id":"zr5REYKOLWpplHNN"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166364927,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                                popFlexibleDialog.execute()\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"NJQm3THYJG0Exl74"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166367764,"flavor":"Greatsword - Attack Roll","content":"23","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":11,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":23,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"ZOkvIgxKQmdYcGjL"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166367797,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                                popFlexibleDialog.execute()\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"q2BCdrafh89ZpDM0"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166370013,"flavor":"Greatsword - Damage Roll (Slashing)","content":"9","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":6,\"active\":true},{\"result\":1,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":9,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"u8bSuGmgTyVrpqwq"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166383439,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                                popFlexibleDialog.execute()\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"BrRgvYsyGhSUloWn"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166386871,"flavor":"Greatsword - Attack Roll","content":"26","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":14,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":26,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"swcQ6zvv3W7Sa6mn"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166386898,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                                popFlexibleDialog.execute()\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"Gz2KD9E7q4vtgeqj"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166389316,"flavor":"Greatsword - Damage Roll (Slashing)","content":"8","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":3,\"active\":true},{\"result\":3,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":8,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"MDGQLMGzTU9d3uru"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166473821,"flavor":"Greatsword - Damage Roll (Slashing)","content":"5","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":2,\"active\":true},{\"result\":1,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":5,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"bHHHl51RNvaAQKhc"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166688737,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const attackMacro = game.macros.find(x => x.name === `Attack Target Token Automate`);\n                                                attackMacro.execute()\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"1cJFp1P9QSx89G7C"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166691106,"flavor":"Greatsword - Attack Roll","content":"25","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":13,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":25,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"QkB3w0NZ8gO0QmJc"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166691140,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const attackMacro = game.macros.find(x => x.name === `Attack Target Token Automate`);\n                                                attackMacro.execute()\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"mXiqNOv1oQst3iCP"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166692858,"flavor":"Greatsword - Damage Roll (Slashing)","content":"8","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":4,\"active\":true},{\"result\":2,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":8,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"aV7o6jExtswFK32M"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166705546,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const attackMacro = game.macros.find(x => x.name === `Attack Target Token Automate`);\n                                                attackMacro.execute()\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"rIvWJ7PdevPsixrK"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166708725,"flavor":"Greatsword - Attack Roll","content":"19","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":7,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":19,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"F4BtBFdfhVN3ZQTr"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166708755,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const attackMacro = game.macros.find(x => x.name === `Attack Target Token Automate`);\n                                                attackMacro.execute()\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"zN9dEY3UMzpZFWcB"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166710381,"flavor":"Greatsword - Damage Roll (Slashing)","content":"10","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":6,\"active\":true},{\"result\":2,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":10,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"gkzZsn5lltVDrVdb"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166768630,"flavor":"<img src=\"icons/weapons/polearms/halberd-crescent-engraved-steel.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const attackMacro = game.macros.find(x => x.name === `Attack Target Token Automate`);\n                                                attackMacro.execute()\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"8efRWbhizpDXQr15"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166775522,"flavor":"Battleaxe - Attack Roll","content":"29","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Battleaxe - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":17,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":29,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"BM4yFcV3LfPVaogN"}}},"_id":"nI08aM3qw6IOtnx0"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166775561,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const attackMacro = game.macros.find(x => x.name === `Attack Target Token Automate`);\n                                                attackMacro.execute()\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"1QpubfvI5tn7fiKA"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166778145,"flavor":"Battleaxe - Damage Roll (Slashing)","content":"5","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Battleaxe - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d8 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":1},\"evaluated\":true,\"number\":1,\"faces\":8,\"modifiers\":[],\"results\":[{\"result\":3,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":5,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"BM4yFcV3LfPVaogN"}}},"_id":"CELZbotDG5MT7uP2"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166861131,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const attackMacro = game.macros.find(x => x.name === `Attack Target Token Automate`);\n                                                attackMacro.execute(window.forge.demoWorld.roWeapon)\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"UCqFZ3zsO7kbzQyQ"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166880634,"flavor":"Greatsword - Attack Roll","content":"19","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":7,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":19,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"GfXouxloay6RggiO"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166932274,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const attackMacro = game.macros.find(x => x.name === `Attack Target Token Automate`);\n                                                attackMacro.execute(window.forge.demoWorld.roWeapon)\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"ARZwjulht76W4Das"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166935990,"flavor":"Greatsword - Attack Roll","content":"25","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":13,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":25,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"8s6RzHr8nfeD5OHu"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166936018,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const attackMacro = game.macros.find(x => x.name === `Attack Target Token Automate`);\n                                                attackMacro.execute(window.forge.demoWorld.roWeapon)\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"c6kl63r4mCg2sv0I"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166941571,"flavor":"Greatsword - Damage Roll (Slashing)","content":"9","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"DamageRoll\",\"options\":{\"flavor\":\"Greatsword - Damage Roll (Slashing)\",\"critical\":false,\"criticalBonusDice\":0,\"multiplyNumeric\":false,\"powerfulCritical\":false,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"2d6 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"baseNumber\":2},\"evaluated\":true,\"number\":2,\"faces\":6,\"modifiers\":[],\"results\":[{\"result\":2,\"active\":true},{\"result\":5,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":9,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"damage","itemId":"ncFgdpdmHawt83DC"}}},"_id":"VVnOki699lB1ZKFx"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649166941621,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const attackMacro = game.macros.find(x => x.name === `Attack Target Token Automate`);\n                                                attackMacro.execute(window.forge.demoWorld.roWeapon)\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"nWvoBnXJ67jrrD5P"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649167226211,"flavor":"<img src=\"icons/weapons/swords/greatsword-guard-gem-blue.webp\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">Make an attack with your weapon!</h3><br /><br /><button id=\"button\"> Attack</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Attack","callback":"async () => {\n\n                // reference global isWeaponDialogDisplayed? TODO guard against multiple attacks opening\n\n                const weapon = window.forge?.demoWorld?.roWeapon;\n\n                // TODO handle special logic for flute and scroll\n                const isFlute = weapon.data.id === \"XcofVtrtXMjDd0lv\" || weapon.data.id === \"TCW4byJcVwBaH5OM\"; // Second one is my flute\n                const isScroll = weapon.data.id === \"dy2S6ufyRYmCI0L1\"; // Scroll is actually not a problem since it has a damage profile\n\n\n                const targetToken = window.forge?.demoWorld?.roTarget;\n                if (!targetToken) console.error(`targetToken needs to be targeted`);\n                const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                if (!weapon) return;\n                let isMiss = false;\n                if (isFlute) {\n                    // The weapon does not have a linked attack and damage profile\n                    // TODO flute path\n                    // Have the target roll a saving throw and fail\n                    // Deal damage, follow normal path\n                } else {\n                    // The weapon has a linked attack and damage profile\n                    let myAtk = await weapon.rollAttack();\n\n                    if (!myAtk) return;\n                    // This next message creates the prompt to deal damage\n\n                    ChatMessage.create(\n                        {\n                            flavor: `<img src=\\\"${window.forge?.demoWorld?.roTarget.actor.data.img}\\\" width=\\\"50px\\\" height=\\\"50px\\\" />`,\n                            content: \"<br /><h3 style=\\\"text-align:center\\\">You hit them! Go ahead and roll damage.</h3><br />\",\n                            buttons: {\n                                button: {\n                                    label: \"Damage\",\n                                    callback: async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const attackMacro = game.macros.find(x => x.name === `Attack Target Token Automate`);\n                                                attackMacro.execute(window.forge.demoWorld.roWeapon)\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                    // TODO reference the attack, fumble, and target's AC\n                    // let isMiss = myAtk.terms[0].number === 1 // window.forge?.demoWorld?.roTarget.actor.data.data.attributes.ac.value\n                }\n                // if (!isMiss) {\n                //     let myDmg = await weapon.rollDamage();\n                //\n                //     let dmgTotal = myDmg.total;\n                //     await targetToken.actor.applyDamage(dmgTotal);\n                //\n                //     let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                //     if (!targetHp) return;\n                //     if (targetHp.value <= targetHp.min) {\n                //         console.log(\"Target died!\");\n                //         const macro = game.macros.getName(\"Dialog Wizard\");\n                //         macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                //     } else {\n                //         popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                //     }\n                // } else {\n                //     popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                // }\n            }"}}}},"_id":"EBlHHXqiWUCjWX3B"}
{"type":5,"user":"FRJk2q4bH9IdLZDf","timestamp":1649174164051,"flavor":"Greatsword - Attack Roll","content":"22","speaker":{"scene":"qE9GgC174smk0aPF","token":"931e8XCZZRAmPoxu","actor":"SIYsggkrLxyCsXE7","alias":"Ro"},"whisper":[],"blind":false,"roll":"{\"class\":\"D20Roll\",\"options\":{\"flavor\":\"Greatsword - Attack Roll\",\"advantageMode\":0,\"defaultRollMode\":\"publicroll\",\"critical\":20,\"fumble\":1,\"rollMode\":\"publicroll\"},\"dice\":[],\"formula\":\"1d20 + 10 + 2\",\"terms\":[{\"class\":\"Die\",\"options\":{\"critical\":20,\"fumble\":1},\"evaluated\":true,\"number\":1,\"faces\":20,\"modifiers\":[],\"results\":[{\"result\":10,\"active\":true}]},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":10},{\"class\":\"OperatorTerm\",\"options\":{},\"evaluated\":true,\"operator\":\"+\"},{\"class\":\"NumericTerm\",\"options\":{},\"evaluated\":true,\"number\":2}],\"total\":22,\"evaluated\":true}","sound":"sounds/dice.wav","emote":false,"flags":{"dnd5e":{"roll":{"type":"attack","itemId":"ncFgdpdmHawt83DC"}}},"_id":"DAeUNYZMoaTjyJWc"}
{"type":0,"user":"FRJk2q4bH9IdLZDf","timestamp":1649174164086,"flavor":"<img src=\"worlds/forgevtt-demo-world/Assets/Tokens/Kenku4.png\" width=\"50px\" height=\"50px\" />","content":"<br /><h3 style=\"text-align:center\">You hit them! Go ahead and roll damage.</h3><br /><br /><button id=\"button\"> Damage</button>","speaker":{"scene":null,"actor":null,"token":null},"whisper":[],"blind":false,"emote":false,"flags":{"world":{"buttons":{"button":{"label":"Damage","callback":"async () => {\n\n                                        const weapon = window.forge?.demoWorld?.roWeapon;\n                                        const targetToken = window.forge?.demoWorld?.roTarget;\n                                        if (!targetToken) console.error(`targetToken needs to be targeted`);\n                                        const popFlexibleDialog = game.macros.find(x => x.name === `PopFlexibleDialog`);\n                                        if (!popFlexibleDialog) console.error(\"Missing macro PopFlexibleDialog\");\n                                        if (!weapon) return;\n                                        let isMiss = false;\n                                        if (!isMiss) {\n                                            let myDmg = await weapon.rollDamage();\n\n                                            let dmgTotal = myDmg.total;\n                                            await targetToken.actor.applyDamage(dmgTotal);\n\n                                            let targetHp = targetToken?.actor?.data?.data?.attributes?.hp;\n                                            if (!targetHp) return;\n                                            if (targetHp.value <= targetHp.min) {\n                                                console.log(\"Target died!\");\n                                                const macro = game.macros.getName(\"Dialog Wizard\");\n                                                macro.execute(\"You hit them!\", `/goto-scene \"Bandit Fight 3\"`);\n                                            } else {\n                                                const attackMacro = game.macros.find(x => x.name === `Attack Target Token Automate`);\n                                                attackMacro.execute(window.forge.demoWorld.roWeapon)\n                                                // popFlexibleDialog.execute(JSON.stringify({content:\"<h3 style=\\\"text-align: center;\\\">Attack again!</h3>\",buttons:{ok: {label: \"Ok\"}}}))\n                                            }\n                                        } else {\n                                            popFlexibleDialog.execute(JSON.stringify({\n                                                content: \"<h3 style=\\\"text-align: center;\\\">You missed.<br/>Attack again!</h3>\",\n                                                buttons: {ok: {label: \"Ok\"}}\n                                            }))\n                                        }\n                                    }"}}}},"_id":"7iRjmFVccpOclTw9"}
